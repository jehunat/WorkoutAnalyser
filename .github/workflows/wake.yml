name: Wake Streamlit App

on:
  schedule:
    - cron: "0 6 * * *"  # minden nap reggel 7:00 magyar id≈ë szerint
  workflow_dispatch:

jobs:
  wake:
    runs-on: ubuntu-latest

    steps:
      - name: Check and wake Streamlit app
        run: |
          APP_URL="https://workout-analyser.streamlit.app/"

          echo "üîç Checking if the app is sleeping..."
          PAGE_CONTENT=$(curl -s -L "$APP_URL")

          # Ellen≈ërz√©s: alszik-e az app
          if echo "$PAGE_CONTENT" | grep -q "get this app back up"; then
            echo "üí§ App is sleeping ‚Äî waking up..."
            python3 - <<'EOF'
import asyncio
from playwright.async_api import async_playwright

async def wake():
    url = "https://your-app-name.streamlit.app"  # <-- IDE is a saj√°t URL-edet
    async with async_playwright() as p:
        browser = await p.chromium.launch(headless=True)
        page = await browser.new_page()
        await page.goto(url)
        # R√°kattint a "Yes, get this app back up!" gombra
        await page.click('button[data-testid="wakeup-button-owner"]')
        await asyncio.sleep(5)
        print("‚úÖ App should be waking up now!")
        await browser.close()

asyncio.run(wake())
EOF
          else
            echo "‚úÖ App already running, no action needed."
          fi
